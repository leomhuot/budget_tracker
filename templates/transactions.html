{% extends 'base.html' %}

{% block title %}All Transactions - Budget Tracker{% endblock %}

{% block content %}
    <h2 class="h4">All Transactions</h2>

    <form action="{{ url_for('transactions') }}" method="get" class="row g-3 align-items-end mb-4">
        <input type="hidden" name="page" value="{{ page }}">
        <input type="hidden" name="per_page" value="{{ per_page }}">
        <div class="col-md-8">
            <label for="search_query" class="form-label visually-hidden">Search Transactions</label>
            <input type="text" class="form-control" id="search_query" name="search_query" value="{{ search_query if search_query else '' }}" placeholder="Search by item, category, amount, date, etc.">
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-primary w-100">Search</button>
        </div>
    </form>
    
    <div class="card shadow-sm">
        {% if transactions %}
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0 align-middle">
                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Type</th>
                        <th scope="col">Category</th>
                        <th scope="col">Item</th>
                        <th scope="col">Description</th>
                        <th scope="col" class="text-end">Amount</th>
                        <th scope="col" class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transactions %}
                    <tr>
                        <td>{{ t.date }}</td>
                        <td>{{ t.type|capitalize }}</td>
                        <td>
                            {% if t.type == 'income' %}
                                <i class="fa-solid {{ income_category_icons.get(t.category, income_category_icons._default) }} me-2"></i>{{ t.category|capitalize }}
                            {% else %}
                                <i class="fa-solid {{ category_icons.get(t.category, category_icons._default) }} me-2"></i>{{ t.category|capitalize }}
                            {% endif %}
                        </td>
                        <td>{{ t.item }}</td>
                        <td>{{ t.description }}</td>
                        <td class="text-end {{ 'income' if t.type == 'income' else 'expense' }}">
                            ${{ "%.2f"|format(t.amount) }}
                        </td>
                        <td class="text-center action-buttons">
                            <a href="{{ url_for('edit', transaction_id=t.id) }}" class="btn btn-sm btn-outline-primary" title="Edit">
                                <i class="fa-solid fa-pencil"></i>
                            </a>
                            <a href="{{ url_for('delete', transaction_id=t.id) }}" class="btn btn-sm btn-outline-danger" title="Delete" onclick="return confirm('Are you sure you want to delete this item?');">
                                <i class="fa-solid fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="card-body text-center">
            <p class="lead">No transactions yet.</p>
        </div>
        {% endif %}
    </div>

    <div class="d-block d-md-flex justify-content-between align-items-center mt-3">
        <div class="mb-2 mb-md-0 text-muted small-text-sm">
            Showing <span class="d-inline-block">{{ (page - 1) * per_page + 1 }} - {{ (page - 1) * per_page + transactions|length }} of {{ total_transactions }} transactions</span>
        </div>
        <div class="mb-2 mb-md-0 d-flex align-items-center">
            <label for="per_page_select" class="form-label me-2 mb-0 small-text-sm">Per page:</label>
            <select class="form-select form-select-sm w-auto" id="per_page_select" onchange="window.location.href = '{{ url_for('transactions', page=1, search_query=search_query) }}&per_page=' + this.value">
                <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
            </select>
        </div>
        <nav aria-label="Page navigation" class="mt-2 mt-md-0 overflow-auto">
            <ul class="pagination mb-0 justify-content-center pagination-sm">
                <li class="page-item {% if page == 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('transactions', page=page-1, per_page=per_page, search_query=search_query) }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% for p in range(1, total_pages + 1) %}
                <li class="page-item {% if p == page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('transactions', page=p, per_page=per_page, search_query=search_query) }}">{{ p }}</a>
                </li>
                {% endfor %}
                <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('transactions', page=page+1, per_page=per_page, search_query=search_query) }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
{% endblock %}
